{"version":3,"file":"/packages/npm.js","sources":["npm/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA,0C;AACA,W;;AAEA,uC;AACA,uC;AACA,gB;AACA,E;;AAEA,sD;AACA,4B;AACA,mB;AACA,c;;AAEA,iF;AACA,oE;AACA,sB;AACA,K;;AAEA,yB;AACA,uC;AACA,Q;;AAEA,gB;AACA,c;;AAEA,wC;AACA,e;AACA,gD;AACA,sB;AACA,K;AACA,G;AACA,E;AACA,iB;AACA,E;;AAEA,mC;AACA,iC;AACA,oB;AACA,8B;AACA,iE;AACA,mB;AACA,wB;AACA,iD;AACA,gE;AACA,mB;AACA,4B;AACA,yC;AACA,U;AACA,iD;AACA,G;;AAEA,0C;AACA,uB;AACA,6C;AACA,yB;AACA,2C;AACA,iD;AACA,c;AACA,mE;AACA,O;AACA,O;AACA,qB;AACA,G;;AAEA,+B;AACA,uB;AACA,2B;AACA,6C;AACA,8C;AACA,+B;AACA,S;;AAEA,0B;AACA,qG;AACA,iF;AACA,sD;AACA,wC;AACA,wC;AACA,6C;AACA,W;AACA,S;AACA,oB;AACA,c;AACA,+B;AACA,O;AACA,M;AACA,G;AACA,E","sourcesContent":["var Future = Npm.require('fibers/future');\nAsync = {};\n\nMeteor.require = function(moduleName) {\n  var module = Npm.require(moduleName);\n  return module;\n};\n\nAsync.runSync = Meteor.sync = function(asynFunction) {\n  var future = new Future();\n  var sent = false;\n  var payload;\n\n  var wrappedAsyncFunction = Meteor.bindEnvironment(asynFunction, function(err) {\n    console.error('Error inside the Async.runSync: ' + err.message);\n    returnFuture(err);\n  });\n\n  setTimeout(function() {\n    wrappedAsyncFunction(returnFuture);\n  }, 0);\n\n  future.wait();\n  sent = true;\n\n  function returnFuture(error, result) {\n    if(!sent) {\n      payload = { result: result, error: error};\n      future.return();\n    }\n  }\n  \n  return payload;\n};\n\nAsync.wrap = function(arg1, arg2) {\n  if(typeof arg1 == 'function') {\n    var func = arg1;\n    return wrapFunction(func);\n  } else if(typeof arg1 == 'object' && typeof arg2 == 'string') {\n    var obj = arg1;\n    var funcName = arg2;\n    return wrapObject(obj, [funcName])[funcName];\n  } else if(typeof arg1 == 'object' &&  arg2 instanceof Array) {\n    var obj = arg1;\n    var funcNameList = arg2;\n    return wrapObject(obj, funcNameList);\n  } else {\n    throw new Error('unsupported argument list');\n  }\n\n  function wrapObject(obj, funcNameList) {\n    var returnObj = {};\n    funcNameList.forEach(function(funcName) {\n      if(obj[funcName]) {\n        var func = obj[funcName].bind(obj);\n        returnObj[funcName] = wrapFunction(func);\n      } else {\n        throw new Error('instance method not exists: ' + funcName);\n      }\n    });\n    return returnObj;\n  }\n\n  function wrapFunction(func) {\n    return function() {\n      var args = arguments;\n      response = Meteor.sync(function(done) {\n        Array.prototype.push.call(args, done);\n        func.apply(null, args);\n      });\n\n      if(response.error) {\n        //we need to wrap a new error here something throw error object comes with response does not \n        //print the correct error to the console, if there is not try catch block\n        var error = new Error(response.error.message);\n        for(var key in response.error) {\n          if(error[key] === undefined) {\n            error[key] = response.error[key];\n          }\n        }\n        throw error;\n      } else {\n        return response.result;\n      }\n    };\n  }\n};"]}