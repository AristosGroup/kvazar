{"version":3,"file":"/packages/accounts-oauth.js","sources":["accounts-oauth/oauth_common.js","accounts-oauth/oauth_server.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,oB;;AAEA,kB;;AAEA,wD;AACA,uD;AACA,kD;AACA,4B;AACA,kD;AACA,wB;;AAEA,sB;AACA,+E;AACA,gF;AACA,gF;AACA,wB;AACA,yD;AACA,sD;AACA,G;AACA,E;;AAEA,2C;AACA,0B;AACA,E;;;;;;;;;;;;;;;;;;;ACvBA,qE;AACA,oD;AACA,kD;AACA,qB;AACA,qC;;AAEA,kD;;AAEA,4D;AACA,uF;AACA,4E;AACA,4E;AACA,qB;AACA,M;AACA,qE;AACA,2E;AACA,0E;AACA,8D;AACA,qE;AACA,8D;AACA,G;AACA,uE;AACA,8B;AACA,qE;AACA,mB;AACA,iB;AACA,M;AACA,kH;AACA,G","sourcesContent":["Accounts.oauth = {};\n\nvar services = {};\n\n// Helper for registering OAuth based accounts packages.\n// On the server, adds an index to the user collection.\nAccounts.oauth.registerService = function (name) {\n  if (_.has(services, name))\n    throw new Error(\"Duplicate service: \" + name);\n  services[name] = true;\n\n  if (Meteor.server) {\n    // Accounts.updateOrCreateUserFromExternalService does a lookup by this id,\n    // so this should be a unique index. You might want to add indexes for other\n    // fields returned by your service (eg services.github.login) but you can do\n    // that in your app.\n    Meteor.users._ensureIndex('services.' + name + '.id',\n                              {unique: 1, sparse: 1});\n  }\n};\n\nAccounts.oauth.serviceNames = function () {\n  return _.keys(services);\n};\n","// Listen to calls to `login` with an oauth option set. This is where\n// users actually get logged in to meteor via oauth.\nAccounts.registerLoginHandler(function (options) {\n  if (!options.oauth)\n    return undefined; // don't handle\n\n  check(options.oauth, {credentialToken: String});\n\n  if (!Oauth.hasCredential(options.oauth.credentialToken)) {\n    // OAuth credentialToken is not recognized, which could be either because the popup\n    // was closed by the user before completion, or some sort of error where\n    // the oauth provider didn't talk to our server correctly and closed the\n    // popup somehow.\n    //\n    // we assume it was user canceled, and report it as such, using a\n    // Meteor.Error which the client can recognize. this will mask failures\n    // where things are misconfigured such that the server doesn't see the\n    // request but does close the window. This seems unlikely.\n    throw new Meteor.Error(Accounts.LoginCancelledError.numericError,\n                           'No matching login attempt found');\n  }\n  var result = Oauth.retrieveCredential(options.oauth.credentialToken);\n  if (result instanceof Error)\n    // We tried to login, but there was a fatal error. Report it back\n    // to the user.\n    throw result;\n  else\n    return Accounts.updateOrCreateUserFromExternalService(result.serviceName, result.serviceData, result.options);\n});\n\n"]}